@model List<TrackingSheet.Models.Kanban.KanbanBoard>
@using Newtonsoft.Json
@using Newtonsoft.Json.Serialization;
@using System.Linq;
@using System.Security.Claims
@using System.IO
@using Microsoft.AspNetCore.Hosting
@inject IWebHostEnvironment env

@{
    
    
    ViewData["Title"] = "Kanban Board";
    var selectedBoardId = ViewBag.SelectedBoardId as Guid?;
    var selectedBoard = selectedBoardId.HasValue
        ? Model.FirstOrDefault(b => b.Id == selectedBoardId.Value)
        : Model.FirstOrDefault();

    // Получение имени пользователя через User.Identity
    var loggedUser = User.Identity.IsAuthenticated ? User.Identity.Name : "Гость";
    var boardId = ViewBag.BoardId;

    // Используйте полное имя класса System.IO.Path.Combine, чтобы избежать затенения
    var avatarPath = System.IO.Path.Combine("avatars", $"{loggedUser}.jpg");
    var avatarFullPath = System.IO.Path.Combine(env.WebRootPath, avatarPath);
    var avatarExists = System.IO.File.Exists(avatarFullPath);
    var avatarUrl = avatarExists ? Url.Content($"~/{avatarPath}") : Url.Content("~/avatars/default.jpg");
}


<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/css/kanban.css" />

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- Передаём loggedUser в JavaScript -->
    <script type="text/javascript">
        var loggedUser = "@loggedUser"; // Теперь переменная доступна в JavaScript
    </script>
    
    
</head>
<body>
    <div class="kanban-container">
        <!-- Tabs for Boards -->
        <div class="kanban-tabs nav nav-tabs d-flex align-items-center">
            @foreach (var board in Model)
            {
                <div class="nav-item tab-item d-flex align-items-center">
                    <a class="nav-link @(board.Id == selectedBoardId ? "active" : "")" onclick="showBoard('@board.Id')">
                        <span class="board-name" id="board-name-@board.Id">@board.Board</span>
                    </a>
                </div>
            }
            <!-- Button to create a new board -->
            <form class="d-flex align-items-center">
                <button type="button" class="btn btn-link" data-toggle="modal" data-target="#createBoardModal">
                    <svg class="icon_note" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 8V16M8 12H16M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z"></path>
                    </svg>
                </button>
            </form>
        </div>

        <!-- Board Content -->
        <div class="kanban-content tab-content">
            @foreach (var board in Model)
            {
                <div class="board-content tab-pane fade @(board.Id == selectedBoardId ? "show active" : "")" id="board-content-@board.Id">
                    <h3 class="header-note-table">
                       
                        <div class="note_buttons">
                            @if (!board.IsProtected)
                            {
                                <button type="button" class="btn btn-link" aria-label="Close" onclick="deleteBoard('@board.Id')">
                                    <svg class="icon_note_table" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M16 6V5.2C16 4.0799 16 3.51984 15.782 3.09202C15.5903 2.71569 15.2843 2.40973 14.908 2.21799C14.4802 2 13.9201 2 12.8 2H11.2C10.0799 2 9.51984 2 9.09202 2.21799C8.71569 2.40973 8.40973 2.71569 8.21799 3.09202C8 3.51984 8 4.0799 8 5.2V6M10 11.5V16.5M14 11.5V16.5M3 6H21M19 6V17.2C19 18.8802 19 19.7202 18.673 20.362C18.3854 20.9265 17.9265 21.3854 17.362 21.673C16.7202 22 15.8802 22 14.2 22H9.8C8.11984 22 7.27976 22 6.63803 21.673C6.07354 21.3854 5.6146 20.9265 5.32698 20.362C5 19.7202 5 18.8802 5 17.2V6"></path>
                                    </svg>
                                </button>
                            }
                            <button type="button" class="btn btn-sm btn-link" onclick="editBoardName('@board.Id')">
                                <svg class="icon_note_table" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18 2L22 6M2 22L3.2764 17.3199C3.35968 17.0145 3.40131 16.8619 3.46523 16.7195C3.52199 16.5931 3.59172 16.4729 3.67332 16.3609C3.76521 16.2348 3.87711 16.1229 4.1009 15.8991L14.4343 5.56569C14.6323 5.36768 14.7313 5.26867 14.8455 5.23158C14.9459 5.19895 15.0541 5.19895 15.1545 5.23158C15.2687 5.26867 15.3677 5.36768 15.5657 5.56569L18.4343 8.43431C18.6323 8.63232 18.7313 8.73133 18.7684 8.84549C18.8011 8.94591 18.8011 9.05409 18.7684 9.15451C18.7313 9.26867 18.6323 9.36768 18.4343 9.56569L8.1009 19.8991C7.87711 20.1229 7.76521 20.2348 7.63908 20.3267C7.52709 20.4083 7.40692 20.478 7.28052 20.5348C7.13815 20.5987 6.98548 20.6403 6.68014 20.7236L2 22Z"></path>
                                </svg>
                            </button>

                            <button type="button" class="btn btn-link" data-toggle="modal" data-target="#addColumnModal" onclick="setAddColumnModalData('@board.Id')">
                                <svg class="icon_note_table" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 5V19M5 12H19"></path>
                                </svg>
                            </button>
                        </div>
                    </h3>

                    <!-- Columns -->
                    <div class="kanban-columns d-flex">
                        @foreach (var column in board.Columns.OrderBy(c => c.Order))
                        {
                            <div class="kanban-column" data-id="@column.Id" data-order="@column.Order">
                                <div class="note-header" style="background-color: @column.ColumnColor;">
                                    <h4 class="mb-0" style="color: @column.ColumnColor;" >@column.Column</h4>
                                    <div class="column-actions">
                                        <!-- Button to add a task -->
                                        <button type="button" class="btn btn-sm btn-link" data-toggle="modal" data-target="#addTaskModal" onclick="setAddTaskModalData('@column.Id')">
                                            <svg class="icon_add" style="stroke: @column.ColumnColor;" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M12 5V19M5 12H19"></path>
                                            </svg>
                                        </button>
                                        <!-- Button to edit column -->
                                        <button type="button" class="btn btn-sm btn-link" data-toggle="modal" data-target="#editColumnModal" onclick="setEditColumnModalData('@column.Id', '@column.Column', '@column.Order', '@column.ColumnColor')">
                                            <svg class="icon_edit_note" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M18 2L22 6M2 22L3.2764 17.3199C3.35968 17.0145 3.40131 16.8619 3.46523 16.7195C3.52199 16.5931 3.59172 16.4729 3.67332 16.3609C3.76521 16.2348 3.87711 16.1229 4.1009 15.8991L14.4343 5.56569C14.6323 5.36768 14.7313 5.26867 14.8455 5.23158C14.9459 5.19895 15.0541 5.19895 15.1545 5.23158C15.2687 5.26867 15.3677 5.36768 15.5657 5.56569L18.4343 8.43431C18.6323 8.63232 18.7313 8.73133 18.7684 8.84549C18.8011 8.94591 18.8011 9.05409 18.7684 9.15451C18.7313 9.26867 18.6323 9.36768 18.4343 9.56569L8.1009 19.8991C7.87711 20.1229 7.76521 20.2348 7.63908 20.3267C7.52709 20.4083 7.40692 20.478 7.28052 20.5348C7.13815 20.5987 6.98548 20.6403 6.68014 20.7236L2 22Z"></path>
                                            </svg>
                                        </button>
                                        <!-- Button to delete column -->
                                        <button type="button" class="btn btn-sm btn-link" onclick="deleteColumn('@column.Id')">
                                            <svg class="icon_delete" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M16 6V5.2C16 4.0799 16 3.51984 15.782 3.09202C15.5903 2.71569 15.2843 2.40973 14.908 2.21799C14.4802 2 13.9201 2 12.8 2H11.2C10.0799 2 9.51984 2 9.09202 2.21799C8.71569 2.40973 8.40973 2.71569 8.21799 3.09202C8 3.51984 8 4.0799 8 5.2V6M10 11.5V16.5M14 11.5V16.5M3 6H21M19 6V17.2C19 18.8802 19 19.7202 18.673 20.362C18.3854 20.9265 17.9265 21.3854 17.362 21.673C16.7202 22 15.8802 22 14.2 22H9.8C8.11984 22 7.27976 22 6.63803 21.673C6.07354 21.3854 5.6146 20.9265 5.32698 20.362C5 19.7202 5 18.8802 5 17.2V6"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <!-- Tasks -->
                                <div class="kanban-tasks">
                                    @foreach (var task in column.Tasks.OrderBy(t => t.Order))
                                    {
                                    <div class="kanban-task" data-id="@task.Id" data-row-version="@Convert.ToBase64String(task.RowVersion)">
                                            
                                            <div class="note-task-header" style="background-color: @task.TaskColor;">
                                                <strong style="color: @task.TaskColor;">@task.TaskName</strong>
                                                <div class="task-actions">  
                                                     
                                                    <!-- Кнопка редактирования задачи -->
                                                    <button type="button" class="btn btn-sm btn-link edit-task-button" data-toggle="modal" data-target="#editTaskModal"
                                                            data-task='@Html.Raw(JsonConvert.SerializeObject(new
                                                        {
                                                            id = task.Id,
                                                            taskName = task.TaskName,
                                                            taskDescription = task.TaskDescription,
                                                            taskColor = task.TaskColor,
                                                            dueDate = task.DueDate?.ToString("yyyy-MM-dd"),
                                                            priority = task.Priority,
                                                            taskAuthor = task.TaskAuthor,
                                                            createdAt = task.CreatedAt.ToString("yyyy-MM-dd HH:mm"),
                                                            columnId = task.KanbanColumnId,
                                                            subtasks = task.Subtasks.Select(s => new
                                                            {
                                                                id = s.Id,
                                                                subtaskDescription = s.SubtaskDescription,
                                                                isCompleted = s.IsCompleted,
                                                                rowVersion = Convert.ToBase64String(s.RowVersion)
                                                            }),
                                                            comments = task.Comments.Select(c => new
                                                            {
                                                                id = c.Id,
                                                                commentAuthor = c.CommentAuthor,
                                                                commentText = c.CommentText,
                                                                createdAt = c.CreatedAt.ToString("yyyy-MM-dd HH:mm"),
                                                                avatarUrl = Url.Content($"~/avatars/{c.CommentAuthor}.jpg"),
                                                                rowVersion = Convert.ToBase64String(c.RowVersion)
                                                            }),
                                                            rowVersion = Convert.ToBase64String(task.RowVersion)
                                                        }, new JsonSerializerSettings
                                                      {
                                                          ContractResolver = new CamelCasePropertyNamesContractResolver(),
                                                          Formatting = Formatting.None
                                                      }))'>
                                                       
                                                    </button>

                                                    <!-- Button to delete task -->
                                                    <button type="button" class="btn btn-sm btn-link" onclick="deleteTask('@task.Id')">
                                                        <svg class="icon_delete" style="stroke: @task.TaskColor;" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M18 6L6 18M6 6L18 18"></path>
                                                        </svg>
                                                    </button>

                                                </div>
                                            </div>

                                            <div class="note-task-icons">

                                                @if (task.TaskDescription != null && task.TaskDescription.Any()) {
                                                <!-- Кнопка описания -->
                                                <button type="button" class="btn btn-sm btn-link toggle-description-button" data-task-id="@task.Id">
                                                    <svg class="icon_task" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M14 2.26953V6.40007C14 6.96012 14 7.24015 14.109 7.45406C14.2049 7.64222 14.3578 7.7952 14.546 7.89108C14.7599 8.00007 15.0399 8.00007 15.6 8.00007H19.7305M14 17H8M16 13H8M20 9.98822V17.2C20 18.8802 20 19.7202 19.673 20.362C19.3854 20.9265 18.9265 21.3854 18.362 21.673C17.7202 22 16.8802 22 15.2 22H8.8C7.11984 22 6.27976 22 5.63803 21.673C5.07354 21.3854 4.6146 20.9265 4.32698 20.362C4 19.7202 4 18.8802 4 17.2V6.8C4 5.11984 4 4.27976 4.32698 3.63803C4.6146 3.07354 5.07354 2.6146 5.63803 2.32698C6.27976 2 7.11984 2 8.8 2H12.0118C12.7455 2 13.1124 2 13.4577 2.08289C13.7638 2.15638 14.0564 2.27759 14.3249 2.44208C14.6276 2.6276 14.887 2.88703 15.4059 3.40589L18.5941 6.59411C19.113 7.11297 19.3724 7.3724 19.5579 7.67515C19.7224 7.94356 19.8436 8.2362 19.9171 8.5423C20 8.88757 20 9.25445 20 9.98822Z"></path>
                                                    </svg>
                                                </button>
                                                }

                                                
                                                @if (task.Comments != null && task.Comments.Any()) {
                                                <!-- Кнопка комментариев -->
                                                <button type="button" class="btn btn-sm btn-link toggle-comments-button" data-task-id="@task.Id">
                                                    <svg class="icon_task" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M7.5 10.5H7.51M12 10.5H12.01M16.5 10.5H16.51M7 18V20.3355C7 20.8684 7 21.1348 7.10923 21.2716C7.20422 21.3906 7.34827 21.4599 7.50054 21.4597C7.67563 21.4595 7.88367 21.2931 8.29976 20.9602L10.6852 19.0518C11.1725 18.662 11.4162 18.4671 11.6875 18.3285C11.9282 18.2055 12.1844 18.1156 12.4492 18.0613C12.7477 18 13.0597 18 13.6837 18H16.2C17.8802 18 18.7202 18 19.362 17.673C19.9265 17.3854 20.3854 16.9265 20.673 16.362C21 15.7202 21 14.8802 21 13.2V7.8C21 6.11984 21 5.27976 20.673 4.63803C20.3854 4.07354 19.9265 3.6146 19.362 3.32698C18.7202 3 17.8802 3 16.2 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V14C3 14.93 3 15.395 3.10222 15.7765C3.37962 16.8117 4.18827 17.6204 5.22354 17.8978C5.60504 18 6.07003 18 7 18ZM8 10.5C8 10.7761 7.77614 11 7.5 11C7.22386 11 7 10.7761 7 10.5C7 10.2239 7.22386 10 7.5 10C7.77614 10 8 10.2239 8 10.5ZM12.5 10.5C12.5 10.7761 12.2761 11 12 11C11.7239 11 11.5 10.7761 11.5 10.5C11.5 10.2239 11.7239 10 12 10C12.2761 10 12.5 10.2239 12.5 10.5ZM17 10.5C17 10.7761 16.7761 11 16.5 11C16.2239 11 16 10.7761 16 10.5C16 10.2239 16.2239 10 16.5 10C16.7761 10 17 10.2239 17 10.5Z"></path>
                                                    </svg>
                                                </button>
                                                }

                                                @if (task.Subtasks != null && task.Subtasks.Any()) {
                                                <!-- Кнопка подзадач -->
                                                <button type="button" class="btn btn-sm btn-link toggle-subtasks-button" data-task-id="@task.Id">
                                                    <svg class="icon_task" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M21 5L10 5M21 19L10 19M21 12L10 12M6 5C6 5.82843 5.32843 6.5 4.5 6.5C3.67157 6.5 3 5.82843 3 5C3 4.17157 3.67157 3.5 4.5 3.5C5.32843 3.5 6 4.17157 6 5ZM6 19C6 19.8284 5.32843 20.5 4.5 20.5C3.67157 20.5 3 19.8284 3 19C3 18.1716 3.67157 17.5 4.5 17.5C5.32843 17.5 6 18.1716 6 19ZM6 12C6 12.8284 5.32843 13.5 4.5 13.5C3.67157 13.5 3 12.8284 3 12C3 11.1716 3.67157 10.5 4.5 10.5C5.32843 10.5 6 11.1716 6 12Z"></path>
                                                    </svg>
                                                </button>
                                                }

                                                <!-- Кнопка вложений -->
                                                <button type="button" class="btn btn-sm btn-link toggle-attachments-button" data-task-id="@task.Id">
                                                    <svg class="icon_task" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M17.5 5.25581V16.5C17.5 19.5376 15.0376 22 12 22C8.96243 22 6.5 19.5376 6.5 16.5V5.66667C6.5 3.64162 8.14162 2 10.1667 2C12.1917 2 13.8333 3.64162 13.8333 5.66667V16.4457C13.8333 17.4583 13.0125 18.2791 12 18.2791C10.9875 18.2791 10.1667 17.4583 10.1667 16.4457V6.65116"></path>
                                                    </svg>
                                                </button>

                                            </div>

                                            <!-- Секция описания -->
                                            <div id="descriptionSection-@task.Id" class="description-section" style="display: none;">
                                                <div class="description">@task.TaskDescription</div>
                                            </div>

                                            <!-- Секция комментариев -->
                                            <div id="commentsSection-@task.Id" class="comments-section" style="display: none;">
                                                <ul class="list-group mb-3">
                                                    @foreach (var comment in task.Comments.OrderByDescending(c => c.CreatedAt))
                                                    {
                                                        <li class="list-group-item">

                                                            <p>@comment.CommentText</p>
                                                            <div class="comm_author">@comment.CommentAuthor</div> 
                                                            <div class="comm_date">@comment.CreatedAt.ToString("yyyy-MM-dd HH:mm")</div>
                                                        </li>
                                                    }
                                                </ul>
                                            </div>

                                            <!-- Секция подзадач -->
                                            <div id="subtasksSection-@task.Id" class="subtasks-section">
                                                <ul class="list-group mb-3">
                                                    @foreach (var subtask in task.Subtasks)
                                                    {
                                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                                            <div>
                                                                <input type="checkbox" class="subtask-checkbox" data-subtask-id="@subtask.Id" data-row-version="@Convert.ToBase64String(subtask.RowVersion)" onchange="toggleSubtaskCompletion('@subtask.Id')" @(subtask.IsCompleted ? "checked" : "")>
                                                                <span>@Html.Raw(Html.Encode(subtask.SubtaskDescription))</span>
                                                            </div>
                                                            <button type="button" class="btn btn-danger btn-sm remove-subtask-button" data-subtask-id="@subtask.Id" data-row-version="@Convert.ToBase64String(subtask.RowVersion)">Удалить</button>
                                                        </li>

                                                    }
                                                </ul>
                                                <!-- Поле для добавления новой подзадачи -->
                                                <div class="input-group mt-2">
                                                    <input type="text" class="form-control add-subtask-input" placeholder="Новая подзадача" />
                                                    <div class="input-group-append">
                                                        <button class="btn btn-primary add-subtask-button" type="button" data-task-id="@task.Id">Добавить</button>
                                                    </div>
                                                </div>
                                            </div>


                                            <!-- Секция вложений -->
                                            <div id="attachmentsSection-@task.Id" class="attachments-section" style="display: none;">
                                                <ul class="list-group mb-3">
                                                    @foreach (var file in task.Files)
                                                    {
                                                        <li class="list-group-item">
                                                            <a href="@file.FileUrl" target="_blank">@file.FileName</a>
                                                        </li>
                                                    }
                                                </ul>

                                                <div class="input-group">
                                                    <input type="file" class="form-control" id="attachmentsInput-@task.Id" multiple />
                                                    <div class="input-group-append">
                                                        <button type="button" class="btn btn-outline-secondary" onclick="uploadAttachments('@task.Id')">
                                                            <svg class="icon_task" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                                <path d="M17.5 5.25581V16.5C17.5 19.5376 15.0376 22 12 22C8.96243 22 6.5 19.5376 6.5 16.5V5.66667C6.5 3.64162 8.14162 2 10.1667 2C12.1917 2 13.8333 3.64162 13.8333 5.66667V16.4457C13.8333 17.4583 13.0125 18.2791 12 18.2791C10.9875 18.2791 10.1667 17.4583 10.1667 16.4457V6.65116"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>

                                             <!-- Display due date and priority -->
                                            @if (task.DueDate.HasValue)
                                            {
                                                <div class="dead_line">Дедлайн: @task.DueDate.Value.ToShortDateString()</div>
                                            }

                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </div>


    <!-- Modals Section -->
    @section Modals {
        <!-- Create Board Modal -->
        <div class="modal fade" id="createBoardModal" tabindex="-1" role="dialog" aria-labelledby="createBoardModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form method="post" asp-action="CreateBoard" asp-controller="Kanban">
                        <div class="modal-header">
                            <h5 class="modal-title" id="createBoardModalLabel">Создать новую доску</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Закрыть">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="boardName">Название новой доски:</label>
                                <input type="text" name="boardName" class="form-control" id="boardName" placeholder="Введите название доски" required />
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                            <button type="submit" class="btn btn-primary">Создать доску</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Add Column Modal -->
        <div class="modal fade" id="addColumnModal" tabindex="-1" role="dialog" aria-labelledby="addColumnModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form method="post" asp-action="AddColumn" asp-controller="Kanban">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addColumnModalLabel">Добавить новую колонку</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Закрыть">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="boardId" id="addColumnBoardId" />
                            <div class="form-group">
                                <label for="columnName">Название колонки:</label>
                                <input type="text" name="columnName" class="form-control" id="columnName" placeholder="Введите название колонки" required />
                            </div>
                        </div>
                        <div class="modal-footer">
                            <span class="text-danger mr-auto" id="addColumnValidationMessage" style="display: none;"></span>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                            <button type="submit" class="btn btn-primary">Добавить колонку</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Edit Column Modal -->
        <div class="modal fade" id="editColumnModal" tabindex="-1" role="dialog" aria-labelledby="editColumnModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form method="post" asp-action="RenameReorderAndRecolorColumn" asp-controller="Kanban">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editColumnModalLabel">Редактировать колонку</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Закрыть">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="ColumnId" id="editColumnId" />
                            <div class="form-group">
                                <label for="editColumnName">Название колонки:</label>
                                <input type="text" name="columnName" class="form-control" id="editColumnName" required />
                            </div>
                            <div class="form-group">
                                <label for="editColumnOrder">Порядок колонки:</label>
                                <input type="number" name="order" class="form-control" id="editColumnOrder" min="1" required />
                            </div>
                            <div class="form-group">
                                <label for="editColumnColor">Цвет колонки:</label>
                                <input type="color" name="columnColor" class="form-control" id="editColumnColor" />
                            </div>
                        </div>
                        <div class="modal-footer">
                            <span class="text-danger mr-auto" id="editColumnValidationMessage" style="display: none;"></span>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                            <button type="submit" class="btn btn-primary">Сохранить изменения</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Add Task Modal -->
        <div class="modal fade" id="addTaskModal" tabindex="-1" role="dialog" aria-labelledby="addTaskModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form id="addTaskForm" method="post" asp-action="AddTask" asp-controller="Kanban" novalidate>
                        <div class="modal-header">
                            <h5 class="modal-title" id="addTaskModalLabel">Добавить задачу</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Закрыть">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="ColumnId" id="addTaskColumnId" />
                            <div class="form-group">
                                <label for="taskName">Название задачи:</label>
                                <input type="text" name="taskName" class="form-control" id="taskName" required />
                            </div>
                            <div class="form-group">
                                <label for="">431:</label>
                                <input type="text" name="taskAuthor" class="form-control" id="taskAuthor" value =@loggedUser required />
                            </div>
                            <div class="form-group">
                                <label for="taskDescription">Описание задачи:</label>
                                <textarea name="taskDescription" class="form-control" id="taskDescription" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="taskColor">Цвет задачи:</label>
                                <input type="color" name="taskColor" class="form-control" id="taskColor" value="#ffffff" required />
                            </div>
                            <div class="form-group">
                                <label for="dueDate">Дедлайн:</label>
                                <input type="date" name="dueDate" class="form-control" id="dueDate" />
                            </div>
                            <div class="form-group">
                                <label for="priority">Приоритет:</label>
                                <select name="priority" class="form-control" id="priority">
                                    <option value="Низкий">Низкий</option>
                                    <option value="Средний">Средний</option>
                                    <option value="Высокий">Высокий</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <span class="text-danger mr-auto" id="addTaskValidationMessage" style="display: none;"></span>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                            <button type="submit" class="btn btn-primary">Добавить задачу</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Edit Task Modal -->
        <div class="modal fade" id="editTaskModal" tabindex="-1" role="dialog" aria-labelledby="editTaskModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form id="editTaskForm" method="post" asp-action="EditTask" asp-controller="Kanban" novalidate>
                        @Html.AntiForgeryToken()
                        <div class="modal-header">
                            <h5 class="modal-title" id="editTaskModalLabel">Редактировать задачу</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Закрыть">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <!-- Нередактируемое поле CreatedAt -->
                            <div class="form-group">
                                <label for="editCreatedAt">Дата создания:</label>
                                <input type="text" name="createdAt" class="form-control" id="editCreatedAt" readonly />
                            </div>

                            <!-- Нередактируемое поле TaskAuthor -->
                            <div class="form-group">
                                <label for="editTaskAuthor">Автор задачи:</label>
                                <input type="text" name="taskAuthor" class="form-control" id="editTaskAuthor" readonly />
                            </div>

                            <input type="hidden" name="taskId" id="editTaskId" />
                            <input type="hidden" name="columnId" id="editTaskColumnId" />

                            <input type="hidden" name="subtasksJson" id="editSubtasksJson" />
                            <input type="hidden" name="rowVersion" id="editTaskRowVersion" /> <!-- camelCase -->

                            <div class="form-group">
                                <label for="editTaskName">Название задачи:</label>
                                <input type="text" name="taskName" class="form-control" id="editTaskName" required />
                            </div>
                            <div class="form-group">
                                <label for="editTaskDescription">Описание задачи:</label>
                                <textarea name="taskDescription" class="form-control" id="editTaskDescription" required></textarea>
                            </div>

                            <!-- Секция комментариев -->
                            <div class="form-group">
                                <label>Комментарии:</label>
                                <ul id="commentsList" class="list-group mb-3">
                                    <!-- Комментарии будут добавляться через JavaScript -->
                                </ul>
                                <div class="input-group">
                                    <input type="text" id="newCommentText" class="form-control" placeholder="Добавить комментарий" />
                                    <div class="input-group-append">
                                        <button type="button" class="btn btn-outline-secondary" onclick="addComment()">Добавить</button>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="editTaskColor">Цвет задачи:</label>
                                <input type="color" name="taskColor" class="form-control" id="editTaskColor" required />
                            </div>
                            <div class="form-group">
                                <label for="editDueDate">Дедлайн:</label>
                                <input type="date" name="dueDate" class="form-control" id="editDueDate" />
                            </div>
                            <div class="form-group">
                                <label for="editPriority">Приоритет:</label>
                                <select name="priority" class="form-control" id="editPriority">
                                    <option value="Низкий">Низкий</option>
                                    <option value="Средний">Средний</option>
                                    <option value="Высокий">Высокий</option>
                                </select>
                            </div>
                            <!-- Секция подзадач -->
                            <div class="form-group">
                                <label>Подзадачи:</label>
                                <ul id="subtasksList" class="list-group">
                                    <!-- Здесь будут динамически добавляться подзадачи -->
                                </ul>
                                <div class="input-group mt-2">
                                    <input type="text" id="newSubtaskDescription" class="form-control" placeholder="Новая подзадача" />
                                    <div class="input-group-append">
                                        <button type="button" class="btn btn-outline-secondary" onclick="addSubtask()">Добавить</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <span class="text-danger mr-auto" id="editTaskValidationMessage" style="display: none;"></span>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                            <button type="submit" class="btn btn-primary">Сохранить изменения</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>



    }
    <script src="~/js/Kanban.js"></script>
    <script src="~/js/kanban_animation.js"></script>
    <script>
        var reporter = '@(TempData.Peek("Login") as string ?? string.Empty)';
        console.log("Reporter:", reporter);
    </script>
</body>
</html>